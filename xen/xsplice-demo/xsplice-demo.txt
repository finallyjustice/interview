# Demo: how to use xsplice

http://wiki.xenproject.org/wiki/XSplice

This is a demo about how to use xsplice. The commit id of xen upstream that I
use is 84787c572d402644dca4874aba73324d9f8e3948.  The commit id of
xsplice-build-tools I use is fd8dadf55f191a537f1eba47be0ba64962730796.

1. Download code of Xen and xsplice-build-tools:
$ git clone http://xenbits.xen.org/git-http/xen.git mainline-xen 
$ git clone git://xenbits.xen.org/people/konradwilk/xsplice-build-tools.git

About xsplice-build-tools/xsplice-build, all "realpath" should be replaced with
"readlink".

2. Apply old.patch to mainline-xen, compile and install.

3. We will xsplice new.patch to the running xen hypervisor. Obtain the build-id
of running Xen with the following command:

root@linux:/soft/img# xl debug-keys x
root@linux:/soft/img# xl dmesg
(XEN) 'x' pressed - Dumping all xsplice patches
(XEN) build-id: d61a9c0630c290dc652ba8f701aa16ac0c11aea2
root@linux:/soft/img#

4. Run make in xsplice-build-tools to compile the tool.

5. Run: 
$ ./xsplice-build -s /home/zhang/test/mainline-xen -p /home/zhang/test/new.patch \
		-o out1 -d --xen-debug --depends d61a9c0630c290dc652ba8f701aa16ac0c11aea2
The output "new.xsplice" is in folder out1.

6. Upload the patch to xen hypervisor:

root@linux:/soft/img# xen-xsplice upload test1 new.xsplice 
Uploading new.xsplice (356864 bytes)

7. Apply the new.xsplice.

root@linux:/soft/img# xen-xsplice apply test1
Performing apply:. completed

8. Play with the new xen hypervisor and finnaly revert:

root@linux:/soft/img# xen-xsplice revert test1
Performing revert:. completed

9. Unload new.xsplice:

root@linux:/soft/img# xen-xsplice unload test1
Performing unload: completed
